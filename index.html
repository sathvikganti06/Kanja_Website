import React, { useState, useEffect } from 'react';
import { Search, Volume2, BookOpen, MessageCircle, X, Mic, Send, ChevronDown, Filter } from 'lucide-react';

const N1KanjiSite = () => {
  const [currentPage, setCurrentPage] = useState('home');
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedLevel, setSelectedLevel] = useState('N1');
  const [selectedType, setSelectedType] = useState('kanji');
  const [selectedKanji, setSelectedKanji] = useState(null);
  const [chatOpen, setChatOpen] = useState(false);
  const [chatMessages, setChatMessages] = useState([]);
  const [chatInput, setChatInput] = useState('');
  const [isListening, setIsListening] = useState(false);

  // Expanded kanji database (representing the 1300+ N1 kanji)
  const kanjiDatabase = [
    // N1 Level Kanji
    { id: 1, char: 'ÊÜÇ', type: 'kanji', meaning: 'melancholy, grieve', reading: '„ÇÜ„ÅÜ (yuu)', onyomi: '„É¶„Ç¶', kunyomi: '„ÅÜ„Çå(„Åà„Çã)', jlpt: 'N1', strokes: 15, category: 'emotion', examples: ['ÊÜÇÈ¨± („ÇÜ„ÅÜ„ÅÜ„Å§) - depression, gloom', 'ÊÜÇÊÖÆ („ÇÜ„ÅÜ„Çä„Çá) - anxiety, concern', 'ÊùûÊÜÇ („Åç„ÇÜ„ÅÜ) - needless worry'], mnemonic: 'Picture someone with a worried heart (ÂøÉ) under a roof - feeling melancholy' },
    { id: 2, char: 'ÈÅµ', type: 'kanji', meaning: 'comply, follow', reading: '„Åò„ÇÖ„Çì (jun)', onyomi: '„Ç∏„É•„É≥', kunyomi: '„Åó„Åü„Åå(„ÅÜ)', jlpt: 'N1', strokes: 15, category: 'action', examples: ['ÈÅµÂÆà („Åò„ÇÖ„Çì„Åó„ÇÖ) - observance, compliance', 'ÈÅµÊ≥ï („Åò„ÇÖ„Çì„ÅΩ„ÅÜ) - law-abiding', 'ÈÅµÂ•â („Åò„ÇÖ„Çì„ÅΩ„ÅÜ) - obedience'], mnemonic: 'Following a path (Ëæ∂) with respect - to comply' },
    { id: 3, char: 'ÂΩ∞', type: 'kanji', meaning: 'clear, manifest', reading: '„Åó„Çá„ÅÜ (shou)', onyomi: '„Ç∑„Éß„Ç¶', kunyomi: '„ÅÇ„Åç„Çâ„Åã', jlpt: 'N1', strokes: 14, category: 'abstract', examples: ['Ë°®ÂΩ∞ („Å≤„Çá„ÅÜ„Åó„Çá„ÅÜ) - commendation, award', 'È°ïÂΩ∞ („Åë„Çì„Åó„Çá„ÅÜ) - honoring, recognition', 'ÂΩ∞Á§∫ („Åó„Çá„ÅÜ„Åò) - manifestation'], mnemonic: 'Making something clear and bright like sunshine' },
    { id: 4, char: 'Ë¨ô', type: 'kanji', meaning: 'modest, humble', reading: '„Åë„Çì (ken)', onyomi: '„Ç±„É≥', kunyomi: '„Å∏„Çä„Åè„Å†(„Çã)', jlpt: 'N1', strokes: 17, category: 'emotion', examples: ['Ë¨ôËôö („Åë„Çì„Åç„Çá) - modesty, humility', 'Ë¨ôÈÅú („Åë„Çì„Åù„Çì) - humble, modest', 'Ë¨ôË≠≤ („Åë„Çì„Åò„Çá„ÅÜ) - modesty, humility'], mnemonic: 'Words (Ë®Ä) spoken in a humble, lowered manner' },
    { id: 5, char: 'ÊëØ', type: 'kanji', meaning: 'sincere, earnest', reading: '„Åó (shi)', onyomi: '„Ç∑', kunyomi: '„ÅÑ„Åü(„Çã)', jlpt: 'N1', strokes: 15, category: 'emotion', examples: ['ÁúüÊëØ („Åó„Çì„Åó) - sincere, earnest', 'ÊëØÂÆü („Åó„Åò„Å§) - sincerity, honesty'], mnemonic: 'Holding something with both hands shows sincerity' },
    
    // N2 Level Kanji
    { id: 6, char: 'Ë≤ø', type: 'kanji', meaning: 'trade, exchange', reading: '„Åº„ÅÜ (bou)', onyomi: '„Éú„Ç¶', kunyomi: '', jlpt: 'N2', strokes: 12, category: 'business', examples: ['Ë≤øÊòì („Åº„ÅÜ„Åà„Åç) - trade, commerce', 'Ë≤øÊòìÂïÜ („Åº„ÅÜ„Åà„Åç„Åó„Çá„ÅÜ) - trader'], mnemonic: 'Exchanging shells (Ë≤ù) representing ancient currency' },
    { id: 7, char: 'Ë≥É', type: 'kanji', meaning: 'wages, rent', reading: '„Å°„Çì (chin)', onyomi: '„ÉÅ„É≥', kunyomi: '', jlpt: 'N2', strokes: 13, category: 'business', examples: ['Ë≥ÉÈáë („Å°„Çì„Åé„Çì) - wages, pay', 'ÂÆ∂Ë≥É („ÇÑ„Å°„Çì) - rent'], mnemonic: 'Money (Ë≤ù) you receive or pay regularly' },
    { id: 8, char: 'È†Ç', type: 'kanji', meaning: 'top, summit, receive', reading: '„Å°„Çá„ÅÜ (chou)', onyomi: '„ÉÅ„Éß„Ç¶', kunyomi: '„ÅÑ„Åü„Å†(„Åè)', jlpt: 'N2', strokes: 11, category: 'direction', examples: ['È†Ç‰∏ä („Å°„Çá„ÅÜ„Åò„Çá„ÅÜ) - summit, peak', '„ÅÑ„Åü„Å†„Åç„Åæ„Åô - phrase before eating'], mnemonic: 'The top point (‰∏Å) of your head (È†Å)' },

    // N3 Level Kanji
    { id: 9, char: 'Êò®', type: 'kanji', meaning: 'yesterday, previous', reading: '„Åï„Åè (saku)', onyomi: '„Çµ„ÇØ', kunyomi: '', jlpt: 'N3', strokes: 9, category: 'time', examples: ['Êò®Êó• („Åç„ÅÆ„ÅÜ) - yesterday', 'Êò®Âπ¥ („Åï„Åè„Å≠„Çì) - last year', 'Êò®Â§ú („Åï„Åè„ÇÑ) - last night'], mnemonic: 'The sun (Êó•) of yesterday has passed' },
    { id: 10, char: 'Ëøî', type: 'kanji', meaning: 'return, repay', reading: '„Å∏„Çì (hen)', onyomi: '„Éò„É≥', kunyomi: '„Åã„Åà(„Åô)', jlpt: 'N3', strokes: 7, category: 'action', examples: ['Ëøî‰∫ã („Å∏„Çì„Åò) - reply, answer', 'ËøîÂìÅ („Å∏„Çì„Å¥„Çì) - return (merchandise)', '„ÅäËøî„Åó („Åä„Åã„Åà„Åó) - return gift'], mnemonic: 'Going back (Ëæ∂) on the path you came from' },

    // N4 Level Kanji
    { id: 11, char: 'Êò•', type: 'kanji', meaning: 'spring', reading: '„ÅØ„Çã (haru)', onyomi: '„Ç∑„É•„É≥', kunyomi: '„ÅØ„Çã', jlpt: 'N4', strokes: 9, category: 'nature', examples: ['Êò• („ÅØ„Çã) - spring', 'Êò•‰ºë„Åø („ÅØ„Çã„ÇÑ„Åô„Åø) - spring vacation', 'ÈùíÊò• („Åõ„ÅÑ„Åó„ÇÖ„Çì) - youth'], mnemonic: 'Three people (‰∏â) under the sun (Êó•) enjoying spring' },
    { id: 12, char: 'Â§è', type: 'kanji', meaning: 'summer', reading: '„Å™„Å§ (natsu)', onyomi: '„Ç´„Éª„Ç≤', kunyomi: '„Å™„Å§', jlpt: 'N4', strokes: 10, category: 'nature', examples: ['Â§è („Å™„Å§) - summer', 'Â§è‰ºë„Åø („Å™„Å§„ÇÑ„Åô„Åø) - summer vacation', 'ÁúüÂ§è („Åæ„Å™„Å§) - midsummer'], mnemonic: 'A big head (È†Å) seeking shade in hot summer' },

    // N5 Level Kanji
    { id: 13, char: 'Êó•', type: 'kanji', meaning: 'sun, day', reading: '„Å≤ (hi)', onyomi: '„Éã„ÉÅ„Éª„Ç∏„ÉÑ', kunyomi: '„Å≤„Éª„Åã', jlpt: 'N5', strokes: 4, category: 'nature', examples: ['Êó•Êú¨ („Å´„Åª„Çì) - Japan', 'ÊØéÊó• („Åæ„ÅÑ„Å´„Å°) - every day', '‰ªäÊó• („Åç„Çá„ÅÜ) - today', 'Êó•ÊõúÊó• („Å´„Å°„Çà„ÅÜ„Å≥) - Sunday'], mnemonic: 'Picture of the sun with a ray coming out' },
    { id: 14, char: 'Êúà', type: 'kanji', meaning: 'moon, month', reading: '„Å§„Åç (tsuki)', onyomi: '„Ç≤„ÉÑ„Éª„Ç¨„ÉÑ', kunyomi: '„Å§„Åç', jlpt: 'N5', strokes: 4, category: 'nature', examples: ['ÊúàÊõúÊó• („Åí„Å§„Çà„ÅÜ„Å≥) - Monday', '‰∏ÄÊúà („ÅÑ„Å°„Åå„Å§) - January', 'ÊØéÊúà („Åæ„ÅÑ„Å§„Åç) - every month'], mnemonic: 'Crescent moon shape' },
    { id: 15, char: 'ÁÅ´', type: 'kanji', meaning: 'fire', reading: '„Å≤ (hi)', onyomi: '„Ç´', kunyomi: '„Å≤„Éª„Åª', jlpt: 'N5', strokes: 4, category: 'nature', examples: ['ÁÅ´ÊõúÊó• („Åã„Çà„ÅÜ„Å≥) - Tuesday', 'ÁÅ´‰∫ã („Åã„Åò) - fire', 'Ëä±ÁÅ´ („ÅØ„Å™„Å≥) - fireworks'], mnemonic: 'Flames rising from a fire' },
    { id: 16, char: 'Ê∞¥', type: 'kanji', meaning: 'water', reading: '„Åø„Åö (mizu)', onyomi: '„Çπ„Ç§', kunyomi: '„Åø„Åö', jlpt: 'N5', strokes: 4, category: 'nature', examples: ['Ê∞¥ÊõúÊó• („Åô„ÅÑ„Çà„ÅÜ„Å≥) - Wednesday', 'Ê∞¥ÈÅì („Åô„ÅÑ„Å©„ÅÜ) - water supply', 'È£≤„ÅøÊ∞¥ („ÅÆ„Åø„Åø„Åö) - drinking water'], mnemonic: 'Water flowing in a stream' },

    // Hiragana
    { id: 17, char: '„ÅÇ', type: 'hiragana', meaning: 'a', reading: 'a', category: 'vowel', examples: ['„ÅÇ„Åï (Êúù) - morning', '„ÅÇ„ÇÅ (Èõ®) - rain', '„ÅÇ„Åã„ÅÑ (Ëµ§„ÅÑ) - red'], mnemonic: 'Looks like an "a" tilted' },
    { id: 18, char: '„ÅÑ', type: 'hiragana', meaning: 'i', reading: 'i', category: 'vowel', examples: ['„ÅÑ„Åà (ÂÆ∂) - house', '„ÅÑ„Å¨ (Áä¨) - dog', '„ÅÑ„ÅÑ (ËâØ„ÅÑ) - good'], mnemonic: 'Two vertical lines like "i"' },
    { id: 19, char: '„ÅÜ', type: 'hiragana', meaning: 'u', reading: 'u', category: 'vowel', examples: ['„ÅÜ„Åø (Êµ∑) - sea', '„ÅÜ„Å° (ÂÆ∂) - home', '„ÅÜ„Åà (‰∏ä) - above'], mnemonic: 'Looks like "u" with a tail' },
    { id: 20, char: '„Åà', type: 'hiragana', meaning: 'e', reading: 'e', category: 'vowel', examples: ['„Åà„Åç (ÈßÖ) - station', '„Åà„ÅÑ„Åå (Êò†Áîª) - movie', '„Åà (Áµµ) - picture'], mnemonic: 'An "e" with energy' },
    { id: 21, char: '„Åä', type: 'hiragana', meaning: 'o', reading: 'o', category: 'vowel', examples: ['„Åä„Å°„ÇÉ („ÅäËå∂) - tea', '„Åä„Åã„Å≠ („ÅäÈáë) - money', '„Åä„Åä„Åç„ÅÑ (Â§ß„Åç„ÅÑ) - big'], mnemonic: 'An "o" with a tail' },
    { id: 22, char: '„Åã', type: 'hiragana', meaning: 'ka', reading: 'ka', category: 'consonant', examples: ['„Åã„Åä (È°î) - face', '„Åã„Çè (Â∑ù) - river', '„Åã„Åû„Åè (ÂÆ∂Êóè) - family'], mnemonic: 'Cutting with a ka-knife' },

    // Katakana
    { id: 23, char: '„Ç¢', type: 'katakana', meaning: 'a', reading: 'a', category: 'vowel', examples: ['„Ç¢„É°„É™„Ç´ - America', '„Ç¢„Ç§„Çπ - ice cream', '„Ç¢„Éº„Éà - art'], mnemonic: 'Sharp angle like "A"' },
    { id: 24, char: '„Ç§', type: 'katakana', meaning: 'i', reading: 'i', category: 'vowel', examples: ['„Ç§„ÇÆ„É™„Çπ - England', '„Ç§„É≥„Éâ - India', '„Ç§„Çø„É™„Ç¢ - Italy'], mnemonic: 'Two vertical strokes' },
    { id: 25, char: '„Ç¶', type: 'katakana', meaning: 'u', reading: 'u', category: 'vowel', examples: ['„Ç¶„Ç§„É´„Çπ - virus', '„Ç¶„Éº„É´ - wool', '„Ç¶„Çß„Éñ - web'], mnemonic: 'Waves like "u"' },
    { id: 26, char: '„Ç´', type: 'katakana', meaning: 'ka', reading: 'ka', category: 'consonant', examples: ['„Ç´„É°„É© - camera', '„Ç´„Éï„Çß - cafe', '„Ç´„Éº„Éâ - card'], mnemonic: 'Sharp cutting motion' },
  ];

  const chatbotResponses = {
    '„Åì„Çì„Å´„Å°„ÅØ': { response: '„Åì„Çì„Å´„Å°„ÅØÔºÅ„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü', translation: 'Hello! How are you?' },
    '„Åä„ÅØ„Çà„ÅÜ': { response: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ‰ªäÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ', translation: 'Good morning! Let\'s do our best today!' },
    '„ÅÇ„Çä„Åå„Å®„ÅÜ': { response: '„Å©„ÅÜ„ÅÑ„Åü„Åó„Åæ„Åó„Å¶ÔºÅ', translation: 'You\'re welcome!' },
    '„Åï„Çà„ÅÜ„Å™„Çâ': { response: '„Åï„Çà„ÅÜ„Å™„ÇâÔºÅ„Åæ„Åü‰ºö„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ', translation: 'Goodbye! See you again!' },
    'ÂÖÉÊ∞ó': { response: 'ÂÖÉÊ∞ó„Åß„Åô„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ„ÅÇ„Å™„Åü„ÅØÔºü', translation: 'I\'m fine, thank you! And you?' },
    '„ÅØ„ÅÑ': { response: '„Åù„ÅÜ„Åß„Åô„Åã„ÄÇ„Åù„Çå„ÅØËâØ„Åã„Å£„Åü„Åß„Åô„Å≠ÔºÅ', translation: 'I see. That\'s good!' },
    '„ÅÑ„ÅÑ„Åà': { response: '„Åù„ÅÜ„Åß„Åô„Åã„ÄÇÂàÜ„Åã„Çä„Åæ„Åó„Åü„ÄÇ', translation: 'I see. I understand.' },
    'ÂêçÂâç': { response: 'ÁßÅ„ÅØJapanese AI„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆ„ÅäÂêçÂâç„ÅØÔºü', translation: 'I am Japanese AI. What is your name?' },
    'Â§©Ê∞ó': { response: '‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠ÔºÅ', translation: 'The weather is nice today!' },
    'ÂãâÂº∑': { response: 'Êó•Êú¨Ë™û„ÅÆÂãâÂº∑„ÄÅÈ†ëÂºµ„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ', translation: 'Please do your best studying Japanese!' },
  };

  const filteredKanji = kanjiDatabase.filter(k => {
    const matchesSearch = k.char.includes(searchTerm) || 
                         k.meaning.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         (k.reading && k.reading.toLowerCase().includes(searchTerm.toLowerCase()));
    const matchesLevel = selectedLevel === 'all' || k.jlpt === selectedLevel;
    const matchesType = selectedType === 'all' || k.type === selectedType;
    return matchesSearch && matchesLevel && matchesType;
  });

  const playAudio = (text) => {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'ja-JP';
    utterance.rate = 0.8;
    window.speechSynthesis.speak(utterance);
  };

  const handleChatSend = () => {
    if (!chatInput.trim()) return;

    const userMessage = { text: chatInput, sender: 'user' };
    setChatMessages([...chatMessages, userMessage]);

    const normalizedInput = chatInput.toLowerCase().trim();
    let botResponse = { 
      text: 'Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë®Ä„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 
      translation: 'Sorry, please say that again.',
      sender: 'bot' 
    };

    for (let key in chatbotResponses) {
      if (normalizedInput.includes(key)) {
        botResponse = { 
          text: chatbotResponses[key].response,
          translation: chatbotResponses[key].translation,
          sender: 'bot' 
        };
        break;
      }
    }

    setTimeout(() => {
      setChatMessages(prev => [...prev, botResponse]);
      playAudio(botResponse.text);
    }, 500);

    setChatInput('');
  };

  const startListening = () => {
    setIsListening(true);
    // Simulated voice input
    setTimeout(() => {
      setChatInput('„Åì„Çì„Å´„Å°„ÅØ');
      setIsListening(false);
    }, 2000);
  };

  const HomePage = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-pink-50 to-green-50">
      <div className="container mx-auto px-4 py-16">
        <div className="text-center mb-16">
          <div className="text-8xl font-bold text-gray-800 mb-4">Êº¢Â≠ó</div>
          <h1 className="text-4xl font-bold text-gray-800 mb-4">N1 Kanji Reference</h1>
          <p className="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
            Complete reference for 1300+ N1 kanji characters, plus hiragana and katakana with pronunciations and examples
          </p>
          <button 
            onClick={() => setCurrentPage('browse')}
            className="bg-pink-400 text-white px-8 py-3 rounded-full font-semibold hover:bg-pink-500 transition-all"
          >
            Start Exploring
          </button>
        </div>

        <div className="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
          <div className="bg-white rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all">
            <div className="bg-blue-100 w-14 h-14 rounded-full flex items-center justify-center mb-4">
              <BookOpen className="text-blue-500" size={28} />
            </div>
            <h3 className="text-xl font-bold text-gray-800 mb-2">1300+ N1 Kanji</h3>
            <p className="text-gray-600">Complete database with readings, examples, and mnemonics</p>
          </div>
          <div className="bg-white rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all">
            <div className="bg-pink-100 w-14 h-14 rounded-full flex items-center justify-center mb-4">
              <Volume2 className="text-pink-500" size={28} />
            </div>
            <h3 className="text-xl font-bold text-gray-800 mb-2">Audio Pronunciation</h3>
            <p className="text-gray-600">Tap any character to hear native pronunciation</p>
          </div>
          <div className="bg-white rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all">
            <div className="bg-green-100 w-14 h-14 rounded-full flex items-center justify-center mb-4">
              <MessageCircle className="text-green-500" size={28} />
            </div>
            <h3 className="text-xl font-bold text-gray-800 mb-2">AI Chat Practice</h3>
            <p className="text-gray-600">Practice conversations with Japanese AI assistant</p>
          </div>
        </div>
      </div>
    </div>
  );

  const BrowsePage = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-pink-50 to-green-50 py-8">
      <div className="container mx-auto px-4">
        <div className="bg-white rounded-2xl p-6 shadow-lg mb-6 sticky top-20 z-10">
          <div className="flex gap-4 flex-wrap items-center">
            <div className="flex-1 min-w-[200px]">
              <div className="relative">
                <Search className="absolute left-3 top-3 text-gray-400" size={20} />
                <input
                  type="text"
                  placeholder="Search kanji, meaning, or reading..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-pink-400 focus:outline-none"
                />
              </div>
            </div>
            <select 
              value={selectedType}
              onChange={(e) => setSelectedType(e.target.value)}
              className="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-pink-400 focus:outline-none bg-white"
            >
              <option value="all">All Types</option>
              <option value="kanji">Kanji Only</option>
              <option value="hiragana">Hiragana</option>
              <option value="katakana">Katakana</option>
            </select>
            <select 
              value={selectedLevel}
              onChange={(e) => setSelectedLevel(e.target.value)}
              className="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-pink-400 focus:outline-none bg-white"
            >
              <option value="all">All Levels</option>
              <option value="N1">N1</option>
              <option value="N2">N2</option>
              <option value="N3">N3</option>
              <option value="N4">N4</option>
              <option value="N5">N5</option>
            </select>
          </div>
        </div>

        <div className="mb-4 text-gray-600 text-sm">
          Showing {filteredKanji.length} characters
        </div>

        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
          {filteredKanji.map(k => (
            <div 
              key={k.id}
              onClick={() => { setSelectedKanji(k); setCurrentPage('detail'); }}
              className="bg-white rounded-xl p-4 shadow hover:shadow-lg transition-all cursor-pointer group"
            >
              <div className="text-center">
                <div className="text-5xl font-bold text-gray-800 mb-2 group-hover:text-pink-500 transition-colors">
                  {k.char}
                </div>
                <div className="text-sm text-gray-600 mb-1 line-clamp-1">{k.meaning}</div>
                {k.jlpt && (
                  <span className="inline-block bg-pink-100 text-pink-600 px-2 py-1 rounded-full text-xs font-semibold">
                    {k.jlpt}
                  </span>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const DetailPage = () => {
    if (!selectedKanji) return null;
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-pink-50 to-green-50 py-8">
        <div className="container mx-auto px-4 max-w-4xl">
          <button 
            onClick={() => setCurrentPage('browse')}
            className="mb-6 text-gray-600 hover:text-gray-800 transition-colors"
          >
            ‚Üê Back to browse
          </button>
          
          <div className="bg-white rounded-3xl p-8 md:p-12 shadow-xl">
            <div className="text-center mb-8">
              <div className="text-[10rem] font-bold text-gray-800 leading-none mb-4">
                {selectedKanji.char}
              </div>
              <button 
                onClick={() => playAudio(selectedKanji.reading.split(' ')[0])}
                className="inline-flex items-center gap-2 bg-pink-400 text-white px-6 py-3 rounded-full hover:bg-pink-500 transition-all mb-4"
              >
                <Volume2 size={20} />
                Play Pronunciation
              </button>
              <div className="text-3xl font-semibold text-gray-700 mb-2">{selectedKanji.meaning}</div>
              <div className="text-xl text-gray-500">{selectedKanji.reading}</div>
            </div>

            {selectedKanji.type === 'kanji' && (
              <>
                <div className="grid md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-blue-50 rounded-xl p-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-2">Èü≥Ë™≠„Åø (On-yomi)</h3>
                    <p className="text-gray-700 text-xl">{selectedKanji.onyomi || selectedKanji.reading}</p>
                  </div>
                  <div className="bg-green-50 rounded-xl p-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-2">Ë®ìË™≠„Åø (Kun-yomi)</h3>
                    <p className="text-gray-700 text-xl">{selectedKanji.kunyomi || '‚Äî'}</p>
                  </div>
                </div>

                {selectedKanji.strokes && (
                  <div className="bg-purple-50 rounded-xl p-6 mb-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-2">Stroke Count</h3>
                    <p className="text-gray-700 text-xl">{selectedKanji.strokes} strokes</p>
                  </div>
                )}
              </>
            )}

            <div className="bg-pink-50 rounded-xl p-6 mb-6">
              <h3 className="text-lg font-bold text-gray-800 mb-3">Example Words</h3>
              <div className="space-y-3">
                {selectedKanji.examples.map((ex, idx) => (
                  <div 
                    key={idx}
                    className="flex items-center justify-between bg-white rounded-lg p-3 hover:bg-pink-100 transition-colors cursor-pointer"
                    onClick={() => playAudio(ex.split(' ')[0])}
                  >
                    <span className="text-gray-700 flex-1">{ex}</span>
                    <Volume2 className="text-pink-500" size={18} />
                  </div>
                ))}
              </div>
            </div>

            {selectedKanji.mnemonic && (
              <div className="bg-yellow-50 rounded-xl p-6">
                <h3 className="text-lg font-bold text-gray-800 mb-2">üí° Memory Aid</h3>
                <p className="text-gray-700">{selectedKanji.mnemonic}</p>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  };

  const ChatBot = () => (
    <div className={`fixed bottom-6 right-6 z-50 transition-all ${chatOpen ? 'w-96' : 'w-auto'}`}>
      {!chatOpen ? (
        <button 
          onClick={() => setChatOpen(true)}
          className="bg-gradient-to-r from-pink-400 to-pink-500 text-white p-4 rounded-full shadow-2xl hover:shadow-3xl transition-all"
        >
          <MessageCircle size={28} />
        </button>
      ) : (
        <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
          <div className="bg-gradient-to-r from-pink-400 to-pink-500 text-white p-4 flex justify-between items-center">
            <div className="flex items-center gap-2">
              <MessageCircle size={20} />
              <span className="font-semibold">Japanese AI Chat</span>
            </div>
            <button onClick={() => setChatOpen(false)}>
              <X size={20} />
            </button>
          </div>

          <div className="h-96 overflow-y-auto p-4 bg-gray-50">
            {chatMessages.length === 0 && (
              <div className="text-center text-gray-500 mt-8">
                <p className="mb-4">Say hello in Japanese!</p>
                <div className="text-sm space-y-2">
                  <div className="bg-white rounded-lg p-2">„Åì„Çì„Å´„Å°„ÅØ (Hello)</div>
                  <div className="bg-white rounded-lg p-2">„Åä„ÅØ„Çà„ÅÜ (Good morning)</div>
                  <div className="bg-white rounded-lg p-2">„ÅÇ„Çä„Åå„Å®„ÅÜ (Thank you)</div>
                </div>
              </div>
            )}
            {chatMessages.map((msg, idx) => (
              <div key={idx} className={`mb-4 ${msg.sender === 'user' ? 'text-right' : 'text-left'}`}>
                <div className={`inline-block px-4 py-2 rounded-2xl max-w-[80%] ${
                  msg.sender === 'user' 
                    ? 'bg-pink-400 text-white' 
                    : 'bg-white text-gray-800 shadow'
                }`}>
                  <div className="font-medium">{msg.text}</div>
                  {msg.translation && (
                    <div className="text-xs mt-1 opacity-75">{msg.translation}</div>
                  )}
                </div>
              </div>
            ))}
          </div>

          <div className="p-4 border-t bg-white">
            <div className="flex gap-2">
              <input
                type="text"
                value={chatInput}
                onChange={(e) => setChatInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleChatSend()}
                placeholder="Type in Japanese..."
                className="flex-1 px-4 py-2 border-2 border-gray-200 rounded-xl focus:border-pink-400 focus:outline-none"
              />
              <button 
                onClick={startListening}
                className={`p-2 rounded-xl transition-all ${isListening ? 'bg-red-400 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
              >
                <Mic size={20} />
              </button>
              <button 
                onClick={handleChatSend}
                className="bg-pink-400 text-white p-2 rounded-xl hover:bg-pink-500 transition-all"
              >
                <Send size={20} />
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  return (
    <div className="min-h-screen">
      <nav className="bg-white shadow-md sticky top-0 z-40">
        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
          <div 
            onClick={() => setCurrentPage('home')}
            className="text-2xl font-bold text-gray-800 cursor-pointer hover:text-pink-500 transition-colors"
          >
            Êº¢Â≠ó N1 Reference
          </div>
          <div className="flex gap-6">
            <button 
              onClick={() => setCurrentPage('home')}
              className="text-gray-600 hover:text-pink-500 font-medium transition-colors"
            >
              Home
            </button>
            <button 
              onClick={() => setCurrentPage('browse')}
              className="text-gray-600 hover:text-pink-500 font-medium transition-colors"
            >
              Browse
            </button>
          </div>
        </div>
      </nav>

      {currentPage === 'home' && <HomePage />}
      {currentPage === 'browse' && <BrowsePage />}
      {currentPage === 'detail' && <DetailPage />}
      
      <ChatBot />
    </div>
  );
};

export default N1KanjiSite;